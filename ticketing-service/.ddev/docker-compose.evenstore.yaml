# ! REGULAR 1 NODE !
services:
  eventstore.db:
    container_name: "ddev-${DDEV_SITENAME}-eventstore.db"
    image: eventstore/eventstore:latest
    environment:
      - EVENTSTORE_INSECURE=True
      - EVENTSTORE_CLUSTER_SIZE=1
      - EVENTSTORE_RUN_PROJECTIONS=All
      - EVENTSTORE_START_STANDARD_PROJECTIONS=True
      - EVENTSTORE_INT_TCP_PORT=1113
      - EVENTSTORE_HTTP_PORT=2113
      - EVENTSTORE_ENABLE_ATOM_PUB_OVER_HTTP=true
      # - EVENTSTORE_ENABLE_EXTERNAL_TCP=true
    ports:
      - "1113:1113"
      - "2113:2113"
    volumes:
      - type: volume
        source: eventstore-volume-data
        target: /var/lib/eventstore-data
      - type: volume
        source: eventstore-volume-index
        target: /var/lib/eventstore-index
      - type: volume
        source: eventstore-volume-logs
        target: /var/log/eventstore
    restart: always
    labels:
      com.ddev.site-name: ${DDEV_SITENAME}
      com.ddev.approot: ${DDEV_APPROOT}

volumes:
  eventstore-volume-data:
  eventstore-volume-index:
  eventstore-volume-logs:


# ! CLUSTERING !
#services:
#  eventstore1:
#    container_name: "ddev-${DDEV_SITENAME}-eventstore1"
#    image: eventstore/eventstore:23.10.0-jammy
#    environment:
#      - EVENTSTORE_INSECURE=True
#      - EVENTSTORE_CLUSTER_SIZE=3
#      - EVENTSTORE_NODE_PRIORITY=1
#      - EVENTSTORE_GOSSIP_SEED=ddev-${DDEV_SITENAME}-eventstore2:2113,ddev-${DDEV_SITENAME}-eventstore3:2113
#      - EVENTSTORE_INT_TCP_PORT=1112
#      - EVENTSTORE_HTTP_PORT=2113
#      - EVENTSTORE_ENABLE_ATOM_PUB_OVER_HTTP=true
#      - EVENTSTORE_RUN_PROJECTIONS=All
#      - EVENTSTORE_START_STANDARD_PROJECTIONS=True
#      - EVENTSTORE_INT_IP=0.0.0.0
#      - EVENTSTORE_EXT_IP=0.0.0.0
#      - EVENTSTORE_DISCOVER_VIA_DNS=false
#    ports:
#      - "2113:2113"
#      - "1112:1112"
#    volumes:
#      - eventstore1-data:/var/lib/eventstore
#      - eventstore1-logs:/var/log/eventstore
#    restart: always
#    labels:
#      com.ddev.site-name: ${DDEV_SITENAME}
#      com.ddev.approot: ${DDEV_APPROOT}
#
#  eventstore2:
#    container_name: "ddev-${DDEV_SITENAME}-eventstore2"
#    image: eventstore/eventstore:23.10.0-jammy
#    environment:
#      - EVENTSTORE_INSECURE=True
#      - EVENTSTORE_CLUSTER_SIZE=3
#      - EVENTSTORE_NODE_PRIORITY=2
#      - EVENTSTORE_GOSSIP_SEED=ddev-${DDEV_SITENAME}-eventstore1:2113,ddev-${DDEV_SITENAME}-eventstore3:2113
#      - EVENTSTORE_INT_TCP_PORT=1112
#      - EVENTSTORE_HTTP_PORT=2113
#      - EVENTSTORE_ENABLE_ATOM_PUB_OVER_HTTP=true
#      - EVENTSTORE_RUN_PROJECTIONS=All
#      - EVENTSTORE_START_STANDARD_PROJECTIONS=True
#      - EVENTSTORE_INT_IP=0.0.0.0
#      - EVENTSTORE_EXT_IP=0.0.0.0
#      - EVENTSTORE_DISCOVER_VIA_DNS=false
#    ports:
#      - "2114:2113"
#      - "1113:1112"
#    volumes:
#      - eventstore2-data:/var/lib/eventstore
#      - eventstore2-logs:/var/log/eventstore
#    restart: always
#    labels:
#      com.ddev.site-name: ${DDEV_SITENAME}
#      com.ddev.approot: ${DDEV_APPROOT}
#
#  eventstore3:
#    container_name: "ddev-${DDEV_SITENAME}-eventstore3"
#    image: eventstore/eventstore:23.10.0-jammy
#    environment:
#      - EVENTSTORE_INSECURE=True
#      - EVENTSTORE_CLUSTER_SIZE=3
#      - EVENTSTORE_NODE_PRIORITY=3
#      - EVENTSTORE_GOSSIP_SEED=ddev-${DDEV_SITENAME}-eventstore1:2113,ddev-${DDEV_SITENAME}-eventstore2:2113
#      - EVENTSTORE_INT_TCP_PORT=1112
#      - EVENTSTORE_HTTP_PORT=2113
#      - EVENTSTORE_ENABLE_ATOM_PUB_OVER_HTTP=true
#      - EVENTSTORE_RUN_PROJECTIONS=All
#      - EVENTSTORE_START_STANDARD_PROJECTIONS=True
#      - EVENTSTORE_INT_IP=0.0.0.0
#      - EVENTSTORE_EXT_IP=0.0.0.0
#      - EVENTSTORE_DISCOVER_VIA_DNS=false
#    ports:
#      - "2115:2113"
#      - "1114:1112"
#    volumes:
#      - eventstore3-data:/var/lib/eventstore
#      - eventstore3-logs:/var/log/eventstore
#    restart: always
#    labels:
#      com.ddev.site-name: ${DDEV_SITENAME}
#      com.ddev.approot: ${DDEV_APPROOT}
#
#volumes:
#  eventstore1-data:
#  eventstore1-logs:
#  eventstore2-data:
#  eventstore2-logs:
#  eventstore3-data:
#  eventstore3-logs:
